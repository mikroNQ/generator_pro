<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>BarGen - Barcode Generator</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
<div class="container">
<div class="card">
    <div class="app-header">
        <img src="assets/logo.png" alt="Logo" class="app-logo">
        <h1>BarGen</h1>
    </div>

    <div class="tabs">
        <button class="tab-btn active" data-tab="datamatrix">DataMatrix</button>
        <button class="tab-btn" data-tab="library">Библиотека</button>
        <button class="tab-btn" data-tab="barcode">Весовые</button>
        <button class="tab-btn" data-tab="simplegen">Конструктор</button>
        <button class="tab-btn" data-tab="weightcarousel">Карусель</button>
    </div>

    <!-- DataMatrix Tab -->
    <div id="tab-datamatrix" class="tab-content active">
        <div id="mode-indicator"><span class="mode-badge default" id="mode-badge">Демо</span></div>
        <div id="code-container"><div id="datamatrix-container"></div></div>
        <div class="dm-carousel-nav" id="dm-nav-arrows" style="display:none">
            <button id="dm-prev-btn" class="dm-arrow-btn">❮</button>
            <button id="dm-next-btn" class="dm-arrow-btn">❯</button>
        </div>
        <div class="code-info" id="code-info" style="display:none">
            <div><span class="label">GTIN:</span> <span class="value" id="info-barcode">-</span></div>
            <div><span class="label">Шаблон:</span> <span class="value" id="info-template">-</span></div>
            <div class="counter" id="info-counter">1/1</div>
        </div>
        <div id="current-code">-</div>
        <div class="dm-carousel-controls">
            <div class="interval-selector">
                <button class="interval-btn" data-interval="0.5">0.5</button>
                <button class="interval-btn active" data-interval="0.7">0.7</button>
                <button class="interval-btn" data-interval="1">1</button>
                <button class="interval-btn" data-interval="2">2</button>
                <input type="number" id="dm-custom-interval" class="custom-interval-input" step="0.1" min="0.1" value="0.7">
            </div>
            <div id="timer" style="text-align:center;margin:10px 0"><span class="pulse" id="countdown">Загрузка...</span></div>
            <div class="dm-play-controls">
                <button class="btn btn-warning btn-sm" id="dm-pause-btn">Стоп</button>
                <button class="btn btn-success btn-sm" id="dm-play-btn" style="display:none">Старт</button>
                <button class="btn btn-primary btn-sm" id="refresh-btn">Обновить</button>
            </div>
        </div>
    </div>

    <!-- Library Tab -->
    <div id="tab-library" class="tab-content">
        <div class="folders-section">
            <h4>Папки (DataMatrix)</h4>
            <div class="folder-list" id="dmFolderList"></div>
            <div style="display:flex;gap:8px;justify-content:center;margin-top:10px">
                <button class="btn btn-primary btn-sm" id="dm-run-folder">Запуск</button>
                <button class="btn btn-warning btn-sm" id="dm-rename-folder">✎</button>
                <button class="btn btn-danger btn-sm" id="dm-delete-folder">×</button>
            </div>
        </div>
        <div class="add-form">
            <label>Добавить GTIN:</label>
            <textarea id="barcode-input" placeholder="Баркоды (каждый с новой строки)"></textarea>
            <div class="hint">EAN-13 → DataMatrix по шаблону</div>
            <div class="form-group" style="margin-top:10px">
                <label>Сохранить в папку:</label>
                <div class="input-group">
                    <select id="dmFolderSelect" style="flex:1"></select>
                    <input type="text" id="dmFolderInput" class="d-none" style="flex:1" placeholder="Имя новой папки">
                    <button class="btn btn-purple btn-sm" id="dmFolderModeBtn" style="min-width:50px;font-size:1.4em;padding:0">＋</button>
                </div>
            </div>
            <div class="template-selector">
                <label>Шаблон:</label>
                <div class="template-btns">
                    <div class="tmpl-btn active" data-template="type1"><span class="tmpl-name">Тип 1</span></div>
                    <div class="tmpl-btn" data-template="type2"><span class="tmpl-name">Тип 2</span></div>
                </div>
            </div>
            <div class="form-row">
                <button class="btn btn-success btn-sm" id="add-btn">Добавить</button>
                <button class="btn btn-secondary btn-sm" id="clear-input-btn">Очистить</button>
            </div>
        </div>
        <div class="bulk-actions">
            <span style="flex:1;font-size:.8em;color:var(--text-light)">В папке: <strong id="dm-items-count">0</strong> <span id="dm-current-folder-name"></span></span>
            <button class="btn btn-outline btn-sm" id="select-all-btn">Все</button>
            <button class="btn btn-outline btn-sm" id="deselect-all-btn">Снять</button>
            <button class="btn btn-danger btn-sm" id="clear-all-btn">×</button>
        </div>
        <div id="dmItemsList" class="weight-items-list"></div>
        <div class="rotation-controls" id="rotation-controls">
            <div id="rotation-status">Создайте папку</div>
            <div style="margin-top:10px;display:flex;justify-content:center;gap:10px">
                <button class="btn btn-success btn-sm" id="start-btn">Запустить</button>
                <button class="btn btn-warning btn-sm" id="stop-btn" style="display:none">Стоп</button>
            </div>
        </div>
        <div class="backup-section">
            <div class="backup-title">Резервное копирование</div>
            <div class="backup-actions">
                <button class="btn btn-primary btn-sm" id="exportDataBtn">Скачать</button>
                <button class="btn btn-dark btn-sm" id="importDataBtn">Загрузить</button>
                <input type="file" id="importFile" accept=".json" style="display:none">
            </div>
        </div>
        <div class="history-panel">
            <h4><span>История (50)</span><button class="btn btn-outline btn-sm" id="clearHistoryBtn" style="padding:4px 8px;font-size:.7em">Очистить</button></h4>
            <div class="history-list" id="historyList"></div>
        </div>
    </div>

    <!-- Barcode Tab -->
    <div id="tab-barcode" class="tab-content">
        <div class="barcode-form">
            <div class="form-group">
                <label>Тип штрихкода</label>
                <select id="barcodeType">
                    <option value="code128_19_piece">47-Code128: штучный (19)</option>
                    <option value="code128_19_weight">49-Code128: весовой (19)</option>
                    <option value="code128_19_price">44-Code128: с ценой (19)</option>
                    <option value="code128_16_cas">77-Code128: CAS (16)</option>
                    <option value="ean13_weight">22-EAN-13: весовой (13)</option>
                </select>
            </div>
            <div id="barcodeParams"></div>
            <label class="checkbox-row"><input type="checkbox" id="simulateError"><span>Симуляция ошибки CRC</span></label>
            <div class="controls"><button class="btn btn-primary" id="generateBarcodeBtn">Сгенерировать</button></div>
        </div>
        <div class="barcode-result" id="barcodeResult" style="display:none">
            <div class="result-text" id="barcodeText">-</div>
            <svg id="barcodeSvg"></svg>
        </div>
    </div>

    <!-- Simple Generator Tab -->
    <div id="tab-simplegen" class="tab-content">
        <div id="sg-view-list">
            <div class="simple-gen-form">
                <div class="form-group">
                    <label>Тип</label>
                    <select id="sgType">
                        <option value="CODE128">Code 128</option>
                        <option value="EAN13">EAN-13</option>
                        <option value="UPC">UPC</option>
                        <option value="ITF14">ITF-14</option>
                    </select>
                </div>
                <div class="form-group"><input type="text" id="sgValue" placeholder="Значение" autocomplete="off"></div>
                <div class="simple-preview"><span style="color:#999;font-size:.8em;position:absolute;top:5px;left:10px">Превью</span><svg id="sgSvg" style="display:none"></svg></div>
                <div class="sg-save-panel">
                    <label style="font-weight:700">Сохранить в папку</label>
                    <div class="form-group" style="margin-top:10px">
                        <div class="input-group">
                            <select id="sgFolderSelect" style="flex:1"></select>
                            <input type="text" id="sgFolderInput" class="d-none" style="flex:1" placeholder="Имя новой папки">
                            <button class="btn btn-purple btn-sm" id="sgFolderModeBtn" style="min-width:50px;font-size:1.4em;padding:0">＋</button>
                        </div>
                    </div>
                    <div class="form-group"><input type="text" id="sgName" placeholder="Название"></div>
                    <button class="btn btn-success" style="width:100%" id="sgAddBtn">Сохранить</button>
                </div>
            </div>
            <div class="folders-section">
                <h4>Мои папки</h4>
                <div id="sgFoldersList"></div>
            </div>
        </div>
        <div id="sg-view-carousel" style="display:none">
            <div class="sg-back-btn" id="sgBackBtn">← Назад</div>
            <h3 id="sgActiveFolderName" style="text-align:center;margin:0 0 15px;color:var(--text-light)">Папка</h3>
            <div class="sg-carousel">
                <div class="sg-display-area">
                    <div class="sg-header-row">
                        <span class="sg-item-name" id="sgCarouselName">-</span>
                        <button class="sg-edit-name-btn" id="sgEditNameBtn" title="Редактировать название">✎</button>
                        <button class="sg-edit-name-btn" id="sgEditCodeBtn" title="Редактировать код">123</button>
                    </div>
                    <svg id="sgCarouselSvg"></svg>
                    <div class="sg-item-counter" id="sgCarouselCounter">0/0</div>
                </div>
                <div class="sg-carousel-nav">
                    <div class="sg-arrow-btn" id="sgPrevBtn">❮</div>
                    <div class="sg-arrow-btn" id="sgNextBtn">❯</div>
                </div>
            </div>
            <div style="margin-top:20px;display:flex;justify-content:center;gap:10px">
                <button class="btn btn-warning btn-sm" id="sgRenameFolderBtn">Переим.</button>
                <button class="btn btn-danger btn-sm" id="sgDeleteFolderBtn">Уд. папку</button>
            </div>
            <div style="text-align:center;margin-top:10px"><button class="btn btn-danger btn-sm" id="sgDeleteItemBtn">Удалить</button></div>
        </div>
    </div>

    <!-- Weight Carousel Tab -->
    <div id="tab-weightcarousel" class="tab-content">
        <div class="folders-section">
            <h4>Папки (Весовые)</h4>
            <div class="folder-list" id="wcFolderList"></div>
            <div style="display:flex;gap:8px;justify-content:center;margin-top:10px">
                <button class="btn btn-primary btn-sm" id="wc-run-folder">Запуск</button>
                <button class="btn btn-warning btn-sm" id="wc-rename-folder">✎</button>
                <button class="btn btn-danger btn-sm" id="wc-delete-folder">×</button>
            </div>
        </div>
        <div class="weight-carousel-form">
            <div class="form-group"><label>Название папки</label><input type="text" id="wcFolderName" placeholder="Сыры, Колбасы..."></div>
            <label style="font-size:.85em;font-weight:600">Префиксы:</label>
            <div class="prefix-checkboxes">
                <label class="prefix-checkbox"><input type="checkbox" id="wcPrefix77" checked><span>77 CAS</span></label>
                <label class="prefix-checkbox"><input type="checkbox" id="wcPrefix22"><span>22 EAN</span></label>
                <label class="prefix-checkbox"><input type="checkbox" id="wcPrefix49"><span>49 C128</span></label>
            </div>
            <div class="form-group"><label>PLU коды</label><textarea id="wcProductCode" placeholder="1234" style="height:70px"></textarea></div>
            <div id="group-discount-section" class="discount-section d-none">
                <label style="font-weight:700">Скидка (49)</label>
                <div class="weight-mode-switch" style="margin-top:8px">
                    <input type="radio" name="discountMode" id="discFixed" value="fixed" checked><label class="weight-mode-label" for="discFixed">Фикс.</label>
                    <input type="radio" name="discountMode" id="discRandom" value="random"><label class="weight-mode-label" for="discRandom">Rand</label>
                </div>
                <div id="disc-fixed-group"><input type="number" id="wcDiscount" value="0" min="0" max="99"><div class="hint">%</div></div>
                <div id="disc-random-group" class="d-none"><div class="weight-range-row"><input type="number" id="wcDiscMin" value="5"><span>—</span><input type="number" id="wcDiscMax" value="30"></div></div>
            </div>
            <hr class="weight-divider">
            <label style="font-weight:700">Вес:</label>
            <div class="weight-mode-switch">
                <input type="radio" name="weightMode" id="weightRandom" value="random" checked><label class="weight-mode-label" for="weightRandom">Random</label>
                <input type="radio" name="weightMode" id="weightFixed" value="fixed"><label class="weight-mode-label" for="weightFixed">Фикс.</label>
            </div>
            <div class="form-group" id="group-random-weight"><label>Диапазон (г)</label><div class="weight-range-row"><input type="number" id="wcWeightMin" value="150"><span>—</span><input type="number" id="wcWeightMax" value="8000"></div></div>
            <div class="form-group d-none" id="group-fixed-weight"><label>Фикс. вес (г)</label><input type="number" id="wcFixedWeight" value="500"></div>
            <div class="form-group"><label id="wcVariationsLabel">Вариаций</label><input type="number" id="wcVariations" value="10" min="1" max="100"><div class="hint" id="wcVariationsHint">Весов на PLU</div></div>
            <div class="controls"><button class="btn btn-purple" id="wcAddToCarousel">Добавить</button></div>
        </div>
        <div class="bulk-actions">
            <span style="flex:1;font-size:.8em;color:var(--text-light)">В папке: <strong id="wc-items-count">0</strong> <span id="wc-current-folder-name"></span></span>
            <button class="btn btn-outline btn-sm" id="wc-select-all">Все</button>
            <button class="btn btn-outline btn-sm" id="wc-deselect-all">Снять</button>
            <button class="btn btn-danger btn-sm" id="wc-clear-selected">×</button>
        </div>
        <div class="weight-items-list" id="wcItemsList"></div>
        <div class="rotation-controls" id="wc-rotation-controls">
            <div id="wc-rotation-status">Создайте папку</div>
            <div style="margin-top:10px;display:flex;justify-content:center;gap:10px">
                <button class="btn btn-success btn-sm" id="wc-start-btn">Старт</button>
                <button class="btn btn-warning btn-sm" id="wc-stop-btn" style="display:none">Стоп</button>
            </div>
        </div>
        <div class="barcode-carousel-display" id="wcCarouselDisplay" style="display:none">
            <div id="wcBarcodeInfo">-</div>
            <div id="wcBarcodeText">-</div>
            <div class="barcode-svg-wrapper">
                <svg id="wcBarcodeSvg"></svg>
            </div>
            <div id="wcCarouselCounter">1/1</div>
            <div class="wc-carousel-nav">
                <button class="wc-arrow-btn" id="wcPrevBtn">❮</button>
                <button class="wc-arrow-btn" id="wcNextBtn">❯</button>
            </div>
        </div>
        <div class="interval-selector">
            <button class="wc-interval-btn" data-interval="0.5">0.5</button>
            <button class="wc-interval-btn active" data-interval="0.7">0.7</button>
            <button class="wc-interval-btn" data-interval="1">1</button>
            <button class="wc-interval-btn" data-interval="2">2</button>
            <input type="number" id="wc-custom-interval" class="custom-interval-input" step="0.1" min="0.1" value="0.7">
        </div>
    </div>
</div>
</div>

<!-- External Libraries -->
<script src="https://unpkg.com/bwip-js@3.0.4/dist/bwip-js-min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>

<!-- Application Scripts (order matters!) -->
<script src="js/app/utils.js"></script>
<script src="js/app/config.js"></script>
<script src="js/app/state.js"></script>
<script src="js/app/storage.js"></script>
<script src="js/generators/generators.js"></script>
<script src="js/ui/ui.js"></script>
<script src="js/controllers/dm.controller.js"></script>
<script src="js/controllers/wc.controller.js"></script>
<script src="js/controllers/sg.controller.js"></script>
<script src="js/controllers/barcode.controller.js"></script>
<script src="js/controllers/tab.controller.js"></script>
<script src="js/controllers/library.controller.js"></script>
<script src="js/main.js"></script>
</body>
</html>
